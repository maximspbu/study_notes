---  
layout: mathjax  
---  
  
# Оптимальный префиксный код.  
  
### Определения.  
  
<aside>  
❗ Пусть $\Lambda~-~$произвольное множество $-$ называется алфавитом, а $a\in\Lambda~-~$символами.  
  
Обозначим за $l(a)$ длину кодовой последовательности $c(a)$ символа $a$.  
  
</aside>  
  
### Условие префиксности.  
  
Чтобы однозначно декодировать кодовую последовательность, нужно ввести так называемое условие префиксности (условие Фано):  
  
<aside>  
❗ Код называется префиксным, если ни одно кодовое слово не является началом другого кодового слова.  
  
</aside>  
  
Более формально:  
  
<aside>  
❗ $\forall a,b\in\Lambda ~~ c(a)=\omega\Rightarrow \not\exists \gamma:c(b)=\omega\gamma$  
  
</aside>  
  
### Оптимальный префиксный код.  
  
Оптимальность префиксного кода зависит от длины сообщения и частоты появления определенных символов в этом сообщении.  
  
Пусть каждому символу $a\in\Lambda$ соответствует вероятность $p(a)$ появления в сообщении.  
  
Заведем ДСВ $l:\Lambda\to\mathbb{N}$ (длина кодовой последовательности символа).  
  
$$  
\Pr\{ l=x \}=\Pr(\{ a\in\Lambda~|~l(a)=x \})  
$$  
  
Теперь можно определить, какой префиксный код будет называться оптимальным:  
  
<aside>  
❗ Оптимальным называется код, который минимизирует математическое ожидание $l$:  
  
$$  
El=\sum_{a\in\Lambda}l(a)\cdot p(a)=\sum_{x\in Im(l)}x\cdot\Pr\{ l=x \}  
$$  
  
</aside>  
  
Теперь необходимо задаться вопросом: “А почему ОПК вообще существует?”  
  
Чтобы ответить на этот вопрос, заметим, что математическое ожидание ограничено снизу.  
Действительно, каждый символ $a$ имеет кодовую последовательность $c(a)$ длины $l(a)\ge 1$.  
Тогда $El\ge\displaystyle\sum_{a\in\Lambda}1\cdot p(a)=1$.  
  
Кроме того, мы всегда можем построить ПК, у которого каждый символ $a$ будет закодирован кодовой последовательностью длины $\lceil\log_2(\|\Lambda\|)\rceil$.  
  
Таким образом, матожидание ограничено, и существуют какие-то ПК. Тогда, кажется, очевидно, что оптимальный префиксный код будет существовать (он может быть не единственный).  
  
### Леммы о кратчайшем префиксе.  
  
Докажем несколько лемм, которые помогут построить ОПК:  
  
<aside>  
❓ Если $\exists a\in\Lambda:c(a)=\omega\gamma$, где $\gamma\in \{ 0,1 \}$, и $\not\exists b\ne a:c(b)=\omega\beta$, то ПК неоптимален.  
  
</aside>  
  
<aside>  
<img src="https://www.notion.so/icons/triangle-alternate_gray.svg" alt="https://www.notion.so/icons/triangle-alternate_gray.svg" width="40px" /> Рассмотрим код $C':c'(a)=\omega$ и $c'(b)=c(b)$, если $b\ne a$.  
  
$El'=El-p(a)l(a)+p(a)\big(l(a)-1\big)=El-p(a)$.  
  
Тогда код $C'$ более оптимальный, так как $El'<El$.  
  
</aside>  
  
Эта лемма говорит, о том, что если в коде есть символ с префиксом, который не является началом кода какого-либо другого символа, то код символа можно укоротить, а значит уменьшить матожидание.  
  
<aside>  
❓ Если $\exists a,b\in\Lambda:p(a)<p(b)$ и $l(a)<l(b)$, то ПК не оптимален.  
  
</aside>  
  
<aside>  
<img src="https://www.notion.so/icons/triangle-alternate_gray.svg" alt="https://www.notion.so/icons/triangle-alternate_gray.svg" width="40px" /> Рассмотрим код $C':c'(a)=c(b),~c'(b)=c(a)$ и $c'(t)=c(t)$, если $t\ne a$ и $t\ne b$.  
  
$El'-El=p(a)l(b)+p(b)l(a)-p(a)l(a)-p(b)l(b)=  
\\=\big(p(a)-p(b)\big)\big(l(b)-l(a)\big)<0$  
  
Тогда код $C'$ более оптимальный, так как $El'<El$.  
  
</aside>  
  
Эта лемма говорит о том, что символы с меньшими вероятностями имеют большую длину кодовой последовательности.  
  
### Лемма о соседстве редких символов.  
  
<aside>  
❓ Если $a,b\in\Lambda~-~$символы с наименьшими вероятностями, то $\exists C:c(a)=\omega0$ и $c(b)=\omega1$, где $l(a)$ и $l(b)~-~$наибольшие среди всех символов.  
  
</aside>  
  
<aside>  
<img src="https://www.notion.so/icons/triangle-alternate_gray.svg" alt="https://www.notion.so/icons/triangle-alternate_gray.svg" width="40px" /> Пусть $C_1~-~$какой-то ОПК. По [лемме выше](/sem2/семестр/Дискретка (Мокаев)/Конспекты/Оптимальный префиксный код/Оптимальный префиксный код) $l_1(a)$ и $l_1(b)$ будут наибольшими.  
  
НУО, положим $l_1(a)\ge l_1(b)$.  
Тогда $c_1(a)=\omega\gamma$, где $\omega=\{ 0,1 \}^{l_1(b)}$ и $\gamma=\{ 0,1 \}^{l_1(b)-l_1(a)}$.  
  
Понятно, что $\omega$ не может быть началом какой-то кодовой последовательности помимо $c_1(a)$, так как $\forall c\ne a ~~ l_1(b)\ge l_1(c)$. В то же время $\omega$ не может быть кодовой последовательностью какого-то символа ввиду префиксности кода $\big(c_1(a)=\omega\gamma\big)$.  
  
Тогда по [лемме](/sem2/семестр/Дискретка (Мокаев)/Конспекты/Оптимальный префиксный код/Оптимальный префиксный код) код $c_1(a)$ может быть укорочен, но $C_1~-~$ОПК $\Rightarrow l_1(a)=l_1(b)$.  
  
НУО, положим $c_1(b)=\alpha1$ и найдём $x\in\Lambda:c_1(x)=\alpha0$. Такой $x$ обязательно найдётся, так как в противном случае $c_1(b)$ [можно укоротить](/sem2/семестр/Дискретка (Мокаев)/Конспекты/Оптимальный префиксный код/Оптимальный префиксный код), что противоречит оптимальности $C_1$.  
  
Теперь можем построить ОПК $C$: $c(a)=c_1(x),~c(x)=c_1(a)$ и $c(t)=c_1(t)$ для остальных символов.  
  
</aside>  
  
### Лемма об ОПК для расширенного алфавита.  
  
<aside>  
❓ Пусть $a,b\in\Lambda~-~$символы с наименьшими вероятностями.  
$\Lambda_1:=\Lambda\setminus\{ a,b \}\cup\{ k \}$, где $k\notin\Lambda$ и $p_1(k)=p(a)+p(b)$.  
  
Если $C_1~-~$ОПК для $\Lambda_1$ и $c_1(k)=\omega$, то $C:c(a)=\omega0,~c(b)=\omega1$ и $c(t)=c_1(t)$ для остальных символов, является ОПК.  
  
</aside>  
  
<aside>  
<img src="https://www.notion.so/icons/triangle-alternate_gray.svg" alt="https://www.notion.so/icons/triangle-alternate_gray.svg" width="40px" /> Найдём зависимость $El$ от $El_1$:  
  
$p(a)l(a)+p(b)l(b)=p(a)\big(l_1(k)+1\big)+p(b)\big(l_1(k)+1\big)=  
\\  
=\big(p(a)+p(b)\big)\big(l_1(k)+1\big)=p_1(k)l_1(k)+p_ 1(k)$  
  
То есть $El=El_1+p_1(k)$.  
  
Предположим, что $C~-~$не ОПК, и возьмём $C'~-~$ОПК $:El'<El$.  
По [лемме о соседстве](/sem2/семестр/Дискретка (Мокаев)/Конспекты/Оптимальный префиксный код/Оптимальный префиксный код) получим, что $c'(a)=\gamma0$ и $c'(b)=\gamma 1$.  
  
Рассмотрим $C_{1}'$ для алфавита $\Lambda_1$. Легко понять, что этот код будет префиксным, так как $a$ и $b~-~$символы с наибольшими кодовыми последовательностями, то есть $\gamma$  не может быть началом других кодовых последовательностей, и $C'$ является префиксным, то есть $\gamma$ не может быть кодовой последовательностью какого-то символа.  
  
Выше мы показали, что $El'=El_{1}'+p_1(k)$, но $El'<El=El_1+p_1(k)$.  
Тогда $El_{1}'<El_1$, но $C_1$ является ОПК $\overset{?!}{\Rightarrow}C~-~$ОПК.  
  
</aside>  
  
### Алгоритм Хаффмана для построения ОПК.  
  
Весь алгоритм по сути сводится к применению [леммы об ОПК для расширенного алфавита](/sem2/семестр/Дискретка (Мокаев)/Конспекты/Оптимальный префиксный код/Оптимальный префиксный код).  
  
<aside>  
⚙ Уменьшаем алфавит, пока не останется $2$ символа. И возвращаемся наверх, используя лемму об ОПК для расширенного алфавита.  
  
</aside>  
  
<aside>  
🔑 Пусть $\Lambda=\{ a,b,c,d,e,f,g \}$.  
  
Распределение вероятностей:  
  
$$  
⁍  
$$  
  
Начинаем спуск вниз:  
  
$a_0=e,~b_0=b\Rightarrow\Lambda_1=\{ a,c,d,f,g,\underbrace{eb } \},$ где $p_1(\underbrace{eb})=0.03+0.08=0.11$  
$a_1=\underbrace{eb},~b_1=f\Rightarrow\Lambda_2=\{ a,c,d,g,\underbrace{ebf } \}$, где $p_2(\underbrace{ebf})=0.11+0.12=0.23$  
$a_2=a,~b_2=d\Rightarrow\Lambda_3=\{ c,g,\underbrace{ebf},\underbrace{ad} \}$, где $p_3(\underbrace{ad})=0.13+0.18=0.31$  
$a_3=g,~b_3=\underbrace{ebf}\Rightarrow\Lambda_4=\{ c,\underbrace{ad },\underbrace{ebfg} \}$, где $p_4(\underbrace{ebfg})=0.23+0.21=0.44$  
$a_4=c,~b_4=\underbrace{ad}\Rightarrow\Lambda_5=\{ \underbrace{ebfg},\underbrace{adc} \}$, где $p_5(\underbrace{adc})=0.25+0.31=0.56$  
  
Начинаем подъем вверх:  
  
$c_5(\underbrace{ebfg})=0$ и $c_5(\underbrace{adc})=1$  
$c_4(c)=10$ и $c_4(\underbrace{ad})=11$  
$c_3(g)=00$ и $c_3(\underbrace{ebf})=01$  
$c_2(a)=110$ и $c_2(d)=111$  
$c_1(\underbrace{eb})=010$ и $c_1(f)=011$  
$c(e)=0100$ и $c(b)=0101$  
  
Тогда ОПК для $\Lambda$:  
  
$$  
⁍  
$$  
  
<aside>  
📎 Деревце по коду.  
  
![Untitled](/sem2/семестр/Дискретка (Мокаев)/Конспекты/Оптимальный префиксный код/Untitled.png)  
  
</aside>  
  
</aside>  
  
### Неравенство Крафта.  
  
Оно нужно для того, чтобы понять, может ли набор длин $\{ l_i \}_{i=1}^m$ соответствовать некоторому префиксному коду.  
  
<aside>  
❓ $\{ l_i \}_{i=1}^m$ соответствует ПК $\Leftrightarrow$ $\displaystyle\sum_{i=1}^m 2^{-l_i}\le 1$  
  
</aside>  
  
<aside>  
<img src="https://www.notion.so/icons/triangle-alternate_gray.svg" alt="https://www.notion.so/icons/triangle-alternate_gray.svg" width="40px" /> $\Rightarrow:$  
Зададим множество кодовых последовательностей, как пути на двоичном дереве от корня до листа (подобно картинке выше).  
  
Пусть корень будет нулевым уровнем. Сопоставим каждой вершине $v$ на уровне $t$ число $a(v)=2^{-t}$. Тогда понятно, что для вершин на уровне $t+1$ $\big($обозначим эти вершины за $N(v)$$\big)$ верно неравенство: $a(v)\ge \displaystyle\sum_{u\in N(v)}a(u)$, так как $|N(v)|\le 2$.  
  
Просуммируем такие неравенства для всех нелистовых вершин и получим:  
  
$$  
\sum_{v~-~\text{не лист} } a(v)\ge\sum_{u~-~\text{не корень} } a(u)  
$$  
  
Исключим все промежуточные (не лист и не корень) вершины и получим желаемое равенство: $1=2^0\ge\displaystyle\sum_{u~-~\text{лист} }a(u)=\sum_{i=1}^m 2^{-l_i}$.  
  
$\Leftarrow:$  
Упорядочим длины кодовых последовательностей: $l_1\le l_2\le\dotsc\le l_m$.  
  
Введем новое обозначение для числа листьев на уровне $j$:  
  
$$  
n_j=|\{ i:l_i=j,i\in\{1,\dotsc,m \} \}|  
$$  
  
Тогда $\displaystyle\sum_{i=1}^m 2^{-l_i}\le 1$ можно переписать иначе: $\displaystyle\sum_{j~\in~1~:~l_m} 2^{-j}\cdot n_j\le 1$.  
  
Выразим отсюда $n_j:n_j\le2^j-\big(2^{j-1}n_1+\dotsc+2n_{j-1}\big) ~~ \forall j\in 1:l_m$.  
  
Если $m=1$, то очевидно, что можно построить ПК (есть всего один символ).  
  
Рассмотрим случай $m\ne 1$ и попробуем построить двочное дерево:  
  
На первом уровне может быть $n_1\le2$ вершин. Тогда $n_2\le 2\cdot(2-n_1)=4-2n_1$.  
Тогда на $j$-том уровне может быть не более $2^j-2^{j-1}n_{1}-\dotsc-2n_{j-1}$.  
  
Кол-во листьев на $j$-том уровне удовлетворяет неравенству, а значит все круто.  
  
</aside>  
