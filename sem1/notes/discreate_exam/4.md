# 4. Расписание, длина и высота расписания. Цепи и критические пути. Теорема о существовании кратчайшего расписания.

### *Определение. Сужение.*
На множестве $A$ задано отношение $R$. Пусть $X\sub A$.
Тогда $R(X)=R~\cap~X^2$ называют сужением $R$ на $X$.

### *Замечание.* В результате сужения свойства могут появиться, но не исчезнуть.

### *Определение. Цепь.*
Цепью на множестве $A$, (строго) частично упорядоченном $R$, называют подмножество $X\sub A$, линейно упорядоченное $R(X)$.

Длиной цепи $X$ считают её мощность $|X|$.

### Примечание. Интуитивно можно понимать так: выкидываем из множества $A$ какие-то элементы вместе со связанными с ними парами в $R$, пока не получится линейный порядок.

### *Определение. Критический путь.*
Критическим путём для элемента $a\in A$ называют цепь максимальной длины, оканчивающейся в $a$.

Если критический путь для $a$ конечен, то его длину $d(a)$ называют глубиной $a$.

### *Определение. Высота множества.*
Высота множества - максимальная глубина элемента в нём.

### *Определение. Расписание.*
$A~-~$непустое множество, (строго) упорядоченное отношением $R$.
$\set{A_1,...,A_n}~-~$разбиение множества $A$. 
Тогда оно называется расписанием, если:
 $\forall a\ne b\in A~~(a,b)\in R~\&\&~b\in A_k\Rarr a\in A_j, j<k$.

### Примечание. Чем-то напоминает множества из теоремы о существовании топологической сортировки.

### *Теорема о существовании кратчайшего расписания.*
$A~-~$конечное, (строго) частично упорядоченное отношением $R$, множество. Тогда множества $A_i=\set{x\in A~|~d(x)=i},i\in1:h$
являются кратчайшим (наименьшей мощности) расписанием на $A$.

### Доказательство:
$0)$ Рассмотрим произвольный критический путь $Z$ для элемента $z_n$.
Пусть на этом пути есть предыдущий элемент $z_{n-1}$.
Так как $Z\setminus\{z\}$ обладает теми же свойствами, что и $Z$, то $Z\setminus\{z\}$
тоже является линейным порядком, а значит, так как $z_n~-~$наибольший элемент в $Z$, то $z_{n-1}~-~$наибольший элемент в $Z\setminus\{z\}$. При этом
$Z\setminus\{z\}~-~$цепь, заканчивающаяся в $z_{n-1}$.
Докажем, что элементы $z_n$ и $z_{n-1}$ находятся на разной глубине, то есть
$d(z_n)\ne d(z_{n-1})$.
Предположим, что $d(z_n)=d(z_{n-1})$.
Тогда $\exist Z':|Z'|=|Z|~-~$критический путь, который заканчивается в $z_{n-1}$ и $z_n\not\in Z'$, так как $z_{n-1}~-~$наибольший элемент в $Z'$ и
$(z_{n-1},z_n)\in R$. Следовательно, существует $z\in Z':$ $(z,z_{n-1})\in R$ и $(z,z_n)\not\in R$, иначе можно построить критический путь для $z_n$, такой что его длина $>|Z'|$, но мы предположили, что $|Z'| = |Z|$. 
Тогда получили противоречие с транзитивностью $\Rarr$ $d(z_n)\ne d(z_{n-1})$. 
Значит максимальная длина цепи может быть равна только $d(z_n)-1$.
Тогда, так как $|Z\setminus\{z\}|=d(z_n)-1$, то $Z\setminus\{z\}~-~$критический путь для $z_{n-1}$, то есть $d(z_{n-1})=d(z_n)-1$.

Доказав этот факт, мы сможем показать, что множества $A_i$ из условия на самом деле не могут быть пустыми.

Теперь покажем, что $\{A_i\}_{i=1}^h~-~$разбиение.
$1)$ Докажем, что $\forall i\in 1:h~~A_i\ne \varnothing$
Рассмотрим критический путь $X$ наибольшей длины в $A$, т.е. $|X|=h$.
Он заканчивается в своём наибольшем элементе $x_n$, для которого верно,
что $d(x_n)=h=max_{a\in A}d(a)$.
Из факта, доказанного выше, мы понимаем, что $d(x_{n-1})=h-1$,
$d(x_{n-2})=h-2,...,d(x_1)=1\Rarr X\cap A_i\ne\varnothing~~\forall i\in 1:h$  $\tiny\blacksquare$

$2)$ $\forall i,j \in 1:h~~i\ne j~~A_i~\cap~A_j =~\varnothing$
Это выполняется, так как глубина элемента определяется единственным образом через длину критического пути для элемента  $\tiny\blacksquare$

$3)$ $\displaystyle\bigcup_{i\in1:h}A_i=A$
$\displaystyle\bigcup_{i\in1:h}A_i\sub A$ выполняется, так как $A_i$ мы составляли из элементов $A$, у каждого из которых есть своя глубина.
$\displaystyle\bigcup_{i\in1:h}A_i\supset A$ выполняется, так как $\forall a\in A~~d(a)\in\N$  $\tiny\blacksquare$

На данный момент доказали, что $\{A_i\}_{i=1}^h~-~$разбиение $A$.
Докажем, что это расписание, то есть:
$4)~\forall a\ne b\in A~~(a,b)\in R~\&\&~b\in A_k\Rarr a\in A_j, j<k$.
Предположим, что $j\ge k$, или $d(a)\ge d(b)$.
Рассмотрим критический путь $C$ для $a$. Известно, что $b\not\in C$,
так как $a~-~$наибольший элемент в $C$ и $(a,b)\in R$.
Возьмём множество $C\cup\set{b}$. Из-за транзитивности это множество окажется линейным порядком, а значит это цепь, оканчивающаяся в $b$.
Тогда, так как $d(b)=k~-~$глубина $b$, то $d(b)\ge |C\cup\set{b}|$,
но $|C\cup\set{b}|=j+1\ge k+1\Rarr k\ge k + 1\Rarr j < k$  $\tiny\blacksquare$

Докажем, что расписание кратчайшее.
$5)$ Пусть есть другое расписание: $\{A'_j\}_{j=1}^s$.
Рассмотрим наибольшую цепь $X:|X|=h$ в $A$.
Так как элементы в $X$ линейно упорядочены, они должны быть назначены в разные элементы расписания. Тогда $|X|=h\le s$  $\tiny\blacksquare$

### Примечание. В $0)$ мы доказывали, что если элементы состоят в отношении, то они не могут иметь одинаковую глубину.
Все элементы цепи состоят в отношении, а значит не могут иметь одинаковую глубину.