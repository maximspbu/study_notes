---  
layout: mathjax  
---  
  
# 10. Формула включений-исключений  
  
### Мощность объединения двух множеств:  
$|A \cup B| = |A| + |B| - |A \cap B|$  
  
### Поясняшки  
  
### Пусть $x~-$ число элементов множества $A$, не входящих в $B$; $y~-$ число элементов $B$, не входящих в $A$; $z$   число элементов в пересечении $A$ и $B$. Тогда $x + z = |A|, y + z = |B|$ и мы  
имеем:  
  
![Untitled](/sem1/семестр/Экзамен по дискретной математике/10 Формула включений-исключений/Untitled.png)  
  
### $|A \cup B| = x + y + z = (x + z) + (y + z) − z =|A| + |B| − |A \cap B|$  
  
### Для трёх множеств рассуждаем аналогично:  
$|A| + |B| + |C|$  учитывает дважды элементы, лежащие в попарных пересечениях. Но если вычесть мощности попарных пересечений  
$|A|+|B|+|C|−|A∩B|−|A∩C|−|B∩C|$,  
то получится, что пересечение всех трех множеств мы учли три раза и вычли три раза $\Rightarrow$ нужно добавить его мощность к ответу:  
$|A ∪ B ∪ C| = |A| + |B| + |C| − |A ∩ B| − |A ∩ C| − |B ∩ C| + |A ∩ B ∩ C|$  
  
### Обобщим рассуждения выше в общую формулу включений-исключений для любого числа множеств:  
  
### Формула включений-исключений  
Мощность объединения $n$ множеств $|A_1∪\dotsc ∪A_n|~−$ это сумма, в которую со знаком ‘$+$' входят все мощности пересечения нечетного количества множеств и со знаком ‘$−$' мощности пересечения четного количества множеств:  
$$\Big|\displaystyle\bigcup_{i=1}^{n}A_i\Big| = \displaystyle\sum_{1\le j \le n} (-1)^{j+1}  
\displaystyle\sum_{1\le i_1 \le \dotsc \le i_j \le n} \Big|\displaystyle\bigcap_{k=1}^j A_{i_k}\Big|$$  
  
### Доказательство  
Проведем по индукции $n~-$ числа множеств.  
База  
Для $n = 2$ проверено выше.  
Индукционный переход  
Пусть для $n=m$ формула уже доказана. Докажем для $n = m+1$.  
$\displaystyle\bigcup_{i=1}^{m+1}A_i = \Big(\bigcup_{i=1}^{m}A_i\Big) \cup A_{m+1}$, т.к. объединение ассоциативно.  
Рассмотрим объединение $m$ элементов выше как объединение двух элементов. Тогда из формулы для $n = 2$:  
$\Big|\displaystyle\bigcup_{i=1}^{m+1}A_i\Big| = \Big|\bigcup_{i=1}^{m}A_i\Big| + |A_{m+1}| - \Big|\Big(\bigcup_{i=1}^{m}A_i\Big) \cap A_{m+1}\Big|$  
Пересечение дистрибутивно (меняем последнее слагаемое):  
$\Big|\displaystyle\bigcup_{i=1}^{m+1}A_i\Big| = \Big|\bigcup_{i=1}^{m}A_i\Big| + |A_{m+1}| - \Big|\bigcup_{i=1}^{m}(A_i\cap A_{m+1})\Big|$  
Тогда для последнего слагаемого можем воспользоваться индукционным предположением:  
$\Big|\displaystyle\bigcup_{i=1}^{m+1}A_i\Big| = \Big|\bigcup_{i=1}^{m}A_i\Big| + |A_{m+1}| -  \displaystyle\sum_{1 \le j \le m} (-1)^{j+1} \displaystyle\sum_{1 \le i_1 \le \dotsc \le i_j \le m} |(A_{i_1}\cap A_{m+1}) \cap \dotsc \cap (A_{i_j} \cap A_{m+1})|$  
В последнем модуле достаточно пересечь лишь один раз с $A_{m+1}$:  
$$\Big|\displaystyle\bigcup_{i=1}^{m+1}A_i\Big| = \Big|\bigcup_{i=1}^{m}A_i\Big| + |A_{m+1}| - \\ - \displaystyle\sum_{1 \le j \le m} (-1)^{j+1} \displaystyle\sum_{1 \le i_1 \le \dotsc \le i_j \le m} \Big|\Big(\displaystyle\bigcap _{k=1}^j A_{i_k}\Big)\cap A_{m+1}\Big|$$  
Занесем минус перед знаками сумм внутрь, четность поменяется:  
$$\Big|\displaystyle\bigcup_{i=1}^{m+1} A_i \Big| = \Big|\bigcup_{i=1}^{m} A_i\Big| + |A_{m+1}| + \displaystyle\sum_{1 \le j \le m} (-1)^{j+2} \displaystyle\sum_{1 \le i_1 \le \dotsc \le i_j \le m} \Big|\Big(\displaystyle\bigcap_{k=1}^j A_{i_k}\Big)\cap A_{m+1}\Big|$$  
Теперь внимательно посмотрим на то, что мы имеем.  
Все, что находится под знаками сумм у нас обязательно содержит $A_{m+1}$ в пересечении с некоторым количеством множеств.  
Слагаемое $|A_{m+1}|$ имеет верный относительно желаемой формулы знак. Слагаемое $\Big|\displaystyle\bigcup_{i=1}^{m}A_i\Big|$  раскрывается по индукционному предположению. Оно содержит все возможные комбинации множеств без $A_{m+1}$.  
Сейчас в сумме мы рассматриваем $j$ множеств и $A_{m+1}$ отдельно. Давайте скажем, что $A_{m+1}$ не будет особенным, и мы также будем пробегаться по нему. Но сейчас все еще учтены только комбинации с $A_{m+1}$ в пересечении. Занеся два слагаемых перед суммами внутрь, будем иметь все пересечения, какие только возможно. Но так как мы теперь рассматриваем не $j$, а $j+1$ множеств, четность числа множеств, входящих в пересечение снова меняется, так как мы больше не будем принудительно пересекать пересечения ещё и с $A_{m+1}$, а значит поменяется знак в формуле. То есть $(-1)^{j+2} \rightsquigarrow (-1)^{j+1}$.  
Итоговая формула:  
$$\Big|\displaystyle\bigcup_{i=1}^{m+1}A_i\Big|  
 = \displaystyle\sum_{1\le j \le m+1} (-1)^{j+1}  
\displaystyle\sum_{1\le i_1 \le \dotsc \le i_j \le m+1} \Big|\displaystyle\bigcap_{k=1}^j A_{i_k}\Big| ~~  \scriptsize\blacksquare$$  
  
![1000010067.png](/sem1/семестр/Экзамен по дискретной математике/10 Формула включений-исключений/1000010067.png)  
